<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin Dashboard | Subjects_666</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        :root { --bg: #05070a; --panel: #0d1117; --accent: #00ff88; --border: rgba(255,255,255,0.1); }
        * { box-sizing: border-box; font-family: sans-serif; }
        body { margin: 0; background: var(--bg); color: white; display: flex; min-height: 100vh; }
        
        aside { width: 260px; background: var(--panel); border-right: 1px solid var(--border); padding: 30px 20px; }
        main { flex: 1; padding: 40px; overflow-y: auto; }

        .card { background: var(--panel); border-radius: 20px; border: 1px solid var(--border); padding: 25px; margin-bottom: 25px; }
        
        table { width: 100%; border-collapse: collapse; }
        th { text-align: left; opacity: 0.5; padding: 15px; border-bottom: 1px solid var(--border); }
        td { padding: 15px; border-bottom: 1px solid rgba(255,255,255,0.02); }

        .btn-icon { background: none; border: none; color: white; cursor: pointer; font-size: 1.2rem; opacity: 0.6; transition: 0.3s; }
        .btn-icon:hover { opacity: 1; color: var(--accent); }

        /* Detay Paneli (Modal) */
        #detail-modal {
            display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0,0,0,0.85); backdrop-filter: blur(10px); z-index: 100;
            align-items: center; justify-content: center;
        }
        .modal-content { background: var(--panel); padding: 40px; border-radius: 30px; width: 90%; max-width: 600px; position: relative; max-height: 90vh; overflow-y: auto; }
        .close-modal { position: absolute; top: 20px; right: 20px; cursor: pointer; font-size: 1.5rem; }

        input { background: #161b22; border: 1px solid var(--border); padding: 12px; border-radius: 10px; color: white; width: 100%; margin-bottom: 10px; }
        .btn-save { background: var(--accent); color: black; border: none; padding: 12px 25px; border-radius: 10px; font-weight: bold; cursor: pointer; width: 100%; margin-top: 10px; }
        
        .test-zone { margin-top: 20px; padding-top: 20px; border-top: 1px solid var(--border); display: flex; gap: 10px; }
        .btn-test { background: #fff; color: #000; border: none; padding: 10px; border-radius: 8px; font-weight: bold; flex: 1; cursor: pointer; }
        .btn-mic-test { background: rgba(255,255,255,0.1); color: #fff; border: 1px solid var(--border); padding: 10px; border-radius: 8px; flex: 1; cursor: pointer; }
        .btn-mic-test.active { background: #ff4d4d; border: none; }
    </style>
</head>
<body>

    <aside>
        <h2 style="color:var(--accent)">SUBJECTS_666</h2>
        <p style="opacity:0.5">YÃ¶netim Paneli</p>
    </aside>

    <main>
        <div class="card">
            <h3>Yeni Kelime Ekle</h3>
            <div style="display:flex; gap:10px;">
                <input type="text" id="new-word" placeholder="Kelime (Ã–rn: Apple)">
                <input type="text" id="new-img" placeholder="GÃ¶rsel URL">
                <button class="btn-save" style="margin:0; width:auto" onclick="addWord()">Ekle</button>
            </div>
        </div>

        <div class="card">
            <table>
                <thead>
                    <tr>
                        <th>Kelime</th>
                        <th>Ä°statistik</th>
                        <th>Detay / Test</th>
                        <th>Ä°ÅŸlem</th>
                    </tr>
                </thead>
                <tbody id="table-body"></tbody>
            </table>
        </div>
    </main>

    <div id="detail-modal">
        <div class="modal-content">
            <span class="close-modal" onclick="closeModal()">Ã—</span>
            <h2 id="modal-title">Kelime Analizi</h2>
            
            <canvas id="myChart" style="margin: 20px 0; max-height: 200px;"></canvas>
            
            <div id="edit-area">
                <label>Kelime:</label>
                <input type="text" id="edit-name">
                <label>GÃ¶rsel URL:</label>
                <input type="text" id="edit-img">
                <button class="btn-save" onclick="saveEdit()">DeÄŸiÅŸiklikleri Kaydet</button>
            </div>

            <div class="test-zone">
                <button class="btn-test" onclick="playTestAudio()">ðŸ”Š Sesi Dinle</button>
                <button id="micTestBtn" class="btn-mic-test" onclick="startMicTest()">ðŸŽ¤ KayÄ±t Testi</button>
            </div>
            <div id="test-result" style="margin-top:10px; text-align:center; font-weight:bold; font-size:14px"></div>
        </div>
    </div>

    <script>
        let words = JSON.parse(localStorage.getItem('subjectWords')) || [];
        let currentEditId = null;
        let chartInstance = null;

        function renderTable() {
            const body = document.getElementById('table-body');
            body.innerHTML = '';
            words.forEach(w => {
                body.innerHTML += `
                    <tr>
                        <td><strong>${w.name}</strong></td>
                        <td>${w.hits || 0} BaÅŸarÄ± / %${w.score || 0}</td>
                        <td><button class="btn-icon" onclick="openModal(${w.id})">âž”</button></td>
                        <td><button style="color:#ff4d4d; background:none; border:none; cursor:pointer" onclick="deleteWord(${w.id})">Sil</button></td>
                    </tr>
                `;
            });
            localStorage.setItem('subjectWords', JSON.stringify(words));
        }

        function addWord() {
            const name = document.getElementById('new-word').value;
            const img = document.getElementById('new-img').value;
            if(!name) return;
            words.push({ id: Date.now(), name, img: img || 'https://picsum.photos/400/250', hits: 0, score: 0, tries: 0 });
            renderTable();
            document.getElementById('new-word').value = '';
            document.getElementById('new-img').value = '';
        }

        function openModal(id) {
            currentEditId = id;
            const word = words.find(w => w.id === id);
            document.getElementById('modal-title').innerText = word.name + " Analizi";
            document.getElementById('edit-name').value = word.name;
            document.getElementById('edit-img').value = word.img;
            document.getElementById('test-result').innerText = '';
            document.getElementById('detail-modal').style.display = 'flex';
            
            const ctx = document.getElementById('myChart').getContext('2d');
            if(chartInstance) chartInstance.destroy();
            chartInstance = new Chart(ctx, {
                type: 'doughnut',
                data: {
                    labels: ['BaÅŸarÄ±lÄ±', 'HatalÄ±'],
                    datasets: [{
                        data: [word.hits, (word.tries || 0) - (word.hits || 0)],
                        backgroundColor: ['#00ff88', '#ff4d4d'],
                        borderWidth: 0
                    }]
                },
                options: { responsive: true, cutout: '70%' }
            });
        }

        function playTestAudio() {
            const name = document.getElementById('edit-name').value;
            const utter = new SpeechSynthesisUtterance(name);
            utter.lang = 'en-US';
            window.speechSynthesis.speak(utter);
        }

        function startMicTest() {
            const btn = document.getElementById('micTestBtn');
            const res = document.getElementById('test-result');
            const target = document.getElementById('edit-name').value.toLowerCase();
            const Speech = window.SpeechRecognition || window.webkitSpeechRecognition;

            if(!Speech) return alert("TarayÄ±cÄ± desteklenmiyor.");
            const rec = new Speech();
            rec.lang = 'en-US';

            rec.onstart = () => { btn.classList.add('active'); btn.innerText = "Dinleniyor..."; res.innerText = ""; };
            rec.onresult = (e) => {
                const result = e.results[0][0].transcript.toLowerCase();
                if(result.includes(target)) {
                    res.innerHTML = '<span style="color:#00ff88">âœ“ Sistem kelimeyi tanÄ±dÄ±!</span>';
                } else {
                    res.innerHTML = `<span style="color:#ff4d4d">TanÄ±nan: "${result}"</span>`;
                }
            };
            rec.onend = () => { btn.classList.remove('active'); btn.innerText = "ðŸŽ¤ KayÄ±t Testi"; };
            rec.start();
        }

        function saveEdit() {
            const word = words.find(w => w.id === currentEditId);
            word.name = document.getElementById('edit-name').value;
            word.img = document.getElementById('edit-img').value;
            renderTable();
            closeModal();
        }

        function deleteWord(id) {
            if(confirm("Silmek istediÄŸinize emin misiniz Efendim?")) {
                words = words.filter(w => w.id !== id);
                renderTable();
            }
        }

        function closeModal() { document.getElementById('detail-modal').style.display = 'none'; }
        renderTable();
    </script>
</body>
</html>
